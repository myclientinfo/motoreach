<?phpclass Extend_User extends Site{	var $table_alias = 'u';	var $table_name = 'auction_users';	var $table_fields = array('ID','location_id','user_type_id', 'fullname',  'email', 'password', 'group_id', 'signup_time', 'sales_id', 'public_preferred', 'alias', 'status', 'balance', 'approved', 'streetaddress', 'city', 'state', 'zip', 'country_id', 'phone', 'mobile', 'opt_in', 'rep_number', 'dealership_name', 'dealer_name', 'dealer_number', 'account_email', 'account_phone');		var $field_list = 'u.*, ut.type as user_type, ct.country, ct.country_code';	var $list_header = array('ID','dealership_name','fullname', 'streetaddress', 'user_type', 'city', 'rep_number', 'country', 'status');		var $table_field_mapping = array(		'ID' => array('type' => 'hidden'),		'country_id' =>  array('type' => 'select', 'link' => 'true', 'table' => 'countries', 'as' => 'ct', 'on' => 'ct.id = u.country_id', 'key'=> 'id', 'value'=>'country', 'label' => 'Country'),		'balance' => array('type' => 'hidden'),		'alias' => array('type' => 'hidden'),		'city' => array('type' => 'text'),		'password' => array('type' => 'smalltext'),		'streetaddress' => array('type' => 'smalltext', 'label'=>'Address'),		'fullname' => array('type' => 'smalltext', 'label'=>'Name'),		//'user_type_id' => array('type' => 'manual_select', 'label' => 'Type'),		'user_type_id' => array('type' => 'select', 'link' => 'true', 'table' => 'user_types', 'as' => 'ut', 'on' => 'ut.id = u.user_type_id', 'key'=> 'id', 'value'=>'type', 'label' => 'Type'),		'state' => array('type' => 'manual_select', 'link' => 'true', 'table' => 'states', 'as' => 's', 'on' => 's.id = u.state', 'key'=> 'id', 'value'=>'state_short', 'label' => 'State'),		'group_id' => array('type' => 'select', 'link' => 'true', 'table' => 'groups', 'as' => 'g', 'on' => 'g.id = u.group_id', 'key'=> 'id', 'value'=>'group_name', 'label' => 'group'),		//'sales_id' => array('type' => 'manual_select', 'link' => 'true', 'table' => 'auction_users', 'as' => 'su', 'on' => 'su.ID = u.sales_id', 'key'=> 'ID', 'value'=>'fullname', 'label' => 'Rep'),		'sales_id' => array('type' => 'hidden'),		'zip'=> array('type'=>'text', 'label'=>'Postcode'),		'dealer_number' => array('type' => 'smalltext'),		'approved' => array('type' => 'no_yes'),		'opt_in' => array('type' => 'no_yes', 'label'=>'Email Opt In'),		'public_preferred' => array('type' => 'manual_select', 'label'=>'Receive Public'),		'status' => array('type' => 'no_yes', 'label'=>'Active')	);		function save(){				if($_POST['password']=='') unset($_POST['password']);		else $_POST['password'] = md5($_POST['password']);				$is_new = $_POST['ID'] == 0;				if($_SESSION['l10n']['country_code']=='IE') $_POST['location_id'] = $_POST['city'];				$id = parent::save();			if(strstr($id, "key 'ID'")){			$id = parent::save();		} else if(strstr($id, "key 'email'")){			$user_data = User::getUserFromEmail($_POST['email']);			$id = $user_data['ID'];			return 'ERROR: Email address already used for user id '.$id;		}				if($is_new){			User::newUserPermissions($id);			if($_POST['ID']) User::createDefaultMatchPreference($id, $state);		} else {			$this->savePermissions($id);		}								return $id;			}		function savePermissions($id){				$query = 'DELETE FROM user_permissions WHERE user_id = '.$id;		$this->runQuery($query);				foreach($_POST['permission'] as $k=>$v){			$query = 'INSERT INTO user_permissions(user_id, permission_id) VALUES('.$id.', '.$v.')';			$this->runQuery($query);		}			}		function deleteUser($id) {		$query = 'DELETE FROM auction_users WHERE ID = ' . $id . ' LIMIT 1';		//Site::runQuery($query);		print $query . "<br>";				$query = 'DELETE FROM match_prefs WHERE  user_id = ' . $id;		//Site::runQuery($query);		print $query . "<br>";				$query = 'DELETE FROM user_permissions WHERE user_id = ' . $id;			//Site::runQuery($query);		print $query . "<br>";				return true;					}}?>